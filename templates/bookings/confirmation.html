{% extends 'base.html' %}

{% block title %}Booking Confirmation - GoExplorer{% endblock %}

{% block content %}
<div class="container my-5">
    
    {% if not booking %}
    <div class="alert alert-danger alert-dismissible fade show" role="alert">
        <h4 class="alert-heading"><i class="fas fa-exclamation-circle"></i> Booking Not Found</h4>
        <p>Unable to load your booking. Please try again or contact support.</p>
        <a href="{% url 'core:home' %}" class="btn btn-primary">Return to Home</a>
        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
    </div>
    {% else %}
    <!-- Back button: Returns to booking form with preserved state -->
    <div class="mb-3">
        <a href="javascript:goBackToBooking()" class="btn btn-outline-secondary" title="Go back and keep your selections">
            <i class="fas fa-arrow-left"></i> Back to Booking
        </a>
    </div>

    <!-- OPTIONAL LOGIN UPSELL (for guests) -->
    {% if not user.is_authenticated %}
    <div class="alert alert-success alert-dismissible fade show" role="alert" style="margin-bottom: 1.5rem; background-color: #e8f5e9; border: 1px solid #4caf50;">
        <h5 style="color: #2e7d32; margin-bottom: 0.5rem;">
            <i class="fas fa-star"></i> Unlock Exclusive Benefits
        </h5>
        <p style="color: #333; margin-bottom: 0.75rem;">
            Create an account to access order history, exclusive offers, and faster bookings.
        </p>
        <a href="{% url 'users:register' %}" class="btn btn-success btn-sm">Create Account</a>
        <a href="{% url 'users:login' %}" class="btn btn-outline-success btn-sm">Login</a>
        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
    </div>
    {% endif %}

    <div class="alert alert-info alert-dismissible fade show" role="alert">
        <h4 class="alert-heading">
            <i class="fas fa-info-circle"></i> Booking Review
        </h4>
        {% if booking.status == 'confirmed' %}
        <p>✅ Your booking has been confirmed! Your reservation is locked.</p>
        {% else %}
        <p>Your booking has been reserved. Please complete the payment to confirm your reservation.</p>
        {% endif %}
        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
    </div>
    
    <div class="row">
        <div class="col-md-8">
            {% if booking.status == 'confirmed' %}
            <h2>Booking Confirmed</h2>
            {% else %}
            <h2 data-testid="booking-confirmation">Booking Summary</h2>
            {% endif %}
            <div class="card mb-4">
                <div class="card-body">
                    <h5 class="card-title">{{ booking.get_booking_type_display }} Booking</h5>
                    <p class="mb-2"><strong>Booking ID:</strong> <code data-testid="booking-id">{{ booking.booking_id }}</code></p>
                    <p class="mb-2"><strong>Status:</strong> <span id="booking-status" class="badge {% if booking.status == 'confirmed' %}bg-success{% elif booking.status == 'expired' %}bg-danger{% else %}bg-warning{% endif %}">{{ booking.get_status_display }}</span></p>
                    {% if booking.reservation_seconds_left is not None %}
                    <p class="mb-2"><strong>Hold Expires In:</strong> <span id="expiry-countdown" data-seconds="{{ booking.reservation_seconds_left }}" data-testid="hold-timer"></span></p>
                    {% endif %}
                    <p class="mb-2"><strong>Guest Name:</strong> {{ booking.customer_name|default:"Missing — contact support" }}</p>
                    <p class="mb-2"><strong>Email:</strong> {{ booking.customer_email|default:"Missing — contact support" }}</p>
                    <p class="mb-2"><strong>Phone:</strong> {{ booking.customer_phone|default:"Missing — contact support" }}</p>
                    
                    {% if booking.hotel_details %}
                    <hr>
                    <h6><i class="fas fa-hotel"></i> Hotel Reservation Details</h6>
                    
                    <!-- Hotel & Room Info (Using SNAPSHOT - frozen at booking time) -->
                    <div style="background-color: #f9f9f9; padding: 1rem; border-radius: 8px; margin-bottom: 1rem;">
                        <p class="mb-2"><strong>Hotel:</strong> <span data-testid="hotel-name">{{ booking.hotel_details.room_type.hotel.name }}</span></p>
                        <p class="mb-2"><strong>Location:</strong> {{ booking.hotel_details.room_type.hotel.city.name }}</p>
                        <p class="mb-2"><strong>Room Type:</strong> <span data-testid="room-type">{% if booking.hotel_details.room_snapshot %}{{ booking.hotel_details.room_snapshot.name }}{% else %}{{ booking.hotel_details.room_type.name }}{% endif %}</span></p>
                        
                        <!-- Room Specs (from snapshot if available) -->
                        <div style="display: flex; gap: 1rem; margin-top: 0.75rem; font-size: 0.9rem; color: #666;">
                            {% if booking.hotel_details.room_snapshot %}
                                {% if booking.hotel_details.room_snapshot.bed_type %}
                                <div style="display: flex; align-items: center; gap: 0.3rem;">
                                    <i class="fas fa-bed" style="color: #FF6B35;"></i>
                                    <span>{{ booking.hotel_details.room_snapshot.bed_type }}</span>
                                </div>
                                {% endif %}
                                
                                {% if booking.hotel_details.room_snapshot.room_size %}
                                <div style="display: flex; align-items: center; gap: 0.3rem;">
                                    <i class="fas fa-ruler-combined" style="color: #FF6B35;"></i>
                                    <span>{{ booking.hotel_details.room_snapshot.room_size }} sqft</span>
                                </div>
                                {% endif %}
                                
                                {% if booking.hotel_details.room_snapshot.max_adults %}
                                <div style="display: flex; align-items: center; gap: 0.3rem;">
                                    <i class="fas fa-users" style="color: #FF6B35;"></i>
                                    <span>{{ booking.hotel_details.room_snapshot.max_adults }} Adults{% if booking.hotel_details.room_snapshot.max_children > 0 %}, {{ booking.hotel_details.room_snapshot.max_children }} Children{% endif %}</span>
                                </div>
                                {% endif %}
                            {% else %}
                                {# Fallback to live data for old bookings #}
                                {% if booking.hotel_details.room_type.bed_type %}
                                <div style="display: flex; align-items: center; gap: 0.3rem;">
                                    <i class="fas fa-bed" style="color: #FF6B35;"></i>
                                    <span>{{ booking.hotel_details.room_type.get_bed_type_display }}</span>
                                </div>
                                {% endif %}
                                
                                {% if booking.hotel_details.room_type.room_size %}
                                <div style="display: flex; align-items: center; gap: 0.3rem;">
                                    <i class="fas fa-ruler-combined" style="color: #FF6B35;"></i>
                                    <span>{{ booking.hotel_details.room_type.room_size }} sqft</span>
                                </div>
                                {% endif %}
                                
                                {% if booking.hotel_details.room_type.max_adults %}
                                <div style="display: flex; align-items: center; gap: 0.3rem;">
                                    <i class="fas fa-users" style="color: #FF6B35;"></i>
                                    <span>{{ booking.hotel_details.room_type.max_adults }} Adults{% if booking.hotel_details.room_type.max_children > 0 %}, {{ booking.hotel_details.room_type.max_children }} Children{% endif %}</span>
                                </div>
                                {% endif %}
                            {% endif %}
                        </div>
                    </div>
                    
                    <!-- Stay Details -->
                    <div style="background-color: #fff5f0; padding: 1rem; border-radius: 8px; border-left: 3px solid #FF6B35; margin-bottom: 1rem;">
                        <p class="mb-2"><strong>Check-in:</strong> <span data-testid="check-in-date">{{ booking.hotel_details.check_in|date:"d M Y" }}</span> ({{ booking.hotel_details.room_type.hotel.checkin_time|time:"H:i"|default:"14:00" }})</p>
                        <p class="mb-2"><strong>Check-out:</strong> <span data-testid="check-out-date">{{ booking.hotel_details.check_out|date:"d M Y" }}</span> ({{ booking.hotel_details.room_type.hotel.checkout_time|time:"H:i"|default:"11:00" }})</p>
                        <p class="mb-2"><strong>Total Nights:</strong> {{ booking.hotel_details.total_nights }}</p>
                        <p class="mb-0"><strong>Rooms:</strong> {{ booking.hotel_details.number_of_rooms }}</p>
                    </div>
                    
                    <!-- Meal Plan (Using SNAPSHOT - frozen at booking time) -->
                    {% if booking.hotel_details.room_snapshot.meal_plan_name or booking.hotel_details.meal_plan %}
                    <div style="background: #f0f7ff; padding: 1rem; border-radius: 6px; border-left: 3px solid #0056b3; margin-bottom: 1rem;">
                        <p class="mb-2" style="color: #0056b3;"><strong><i class="fas fa-utensils"></i> Meal Plan Included</strong></p>
                        {% if booking.hotel_details.room_snapshot %}
                            <p class="mb-1"><strong data-testid="meal-plan">{{ booking.hotel_details.room_snapshot.meal_plan_name }}</strong></p>
                            {% if booking.hotel_details.room_snapshot.meal_plan_inclusions %}
                            <p class="text-muted small mb-1">
                                Includes: 
                                {% for inclusion in booking.hotel_details.room_snapshot.meal_plan_inclusions %}
                                    {{ inclusion }}{% if not forloop.last %}, {% endif %}
                                {% endfor %}
                            </p>
                            {% endif %}
                        {% else %}
                            {# Fallback to live data for old bookings #}
                            <p class="mb-1"><strong data-testid="meal-plan">{{ booking.hotel_details.meal_plan.meal_plan.get_plan_type_display|default:booking.hotel_details.meal_plan.name }}</strong></p>
                            {% if booking.hotel_details.meal_plan.meal_plan.inclusions %}
                            <p class="text-muted small mb-1">
                                Includes: 
                                {% for inclusion in booking.hotel_details.meal_plan.meal_plan.inclusions %}
                                    {{ inclusion }}{% if not forloop.last %}, {% endif %}
                                {% endfor %}
                            </p>
                            {% elif booking.hotel_details.meal_plan.description %}
                            <p class="text-muted small mb-1">{{ booking.hotel_details.meal_plan.description }}</p>
                            {% endif %}
                        {% endif %}
                    </div>
                    {% endif %}
                    
                    <!-- Important Policies -->
                    {% if booking.hotel_details.room_type.hotel.policies.all %}
                    <div style="background: #fff9e6; padding: 1rem; border-radius: 6px; border-left: 3px solid #FFB800; margin-top: 1rem;">
                        <p style="color: #7a5b00; margin-bottom: 0.75rem;"><strong><i class="fas fa-info-circle"></i> Key Policies</strong></p>
                        {% for policy in booking.hotel_details.room_type.hotel.policies.all|slice:":3" %}
                        {% if policy.is_highlighted or forloop.counter <= 3 %}
                        <p class="mb-1" style="font-size: 0.85rem; color: #555;">
                            <i class="fas fa-check" style="color: #FFB800;"></i> {{ policy.label }}
                        </p>
                        {% endif %}
                        {% endfor %}
                    </div>
                    {% endif %}
                    
                    {% elif booking.bus_details %}
                    <hr>
                    <h6>Bus Booking Details</h6>
                    <p class="mb-2"><strong>Bus:</strong> {{ booking.bus_details.bus_schedule.route.bus.bus_name }}</p>
                    <p class="mb-2"><strong>Operator:</strong> {{ booking.bus_details.bus_schedule.route.bus.operator.name }}</p>
                    <p class="mb-2"><strong>Route:</strong> {{ booking.bus_details.bus_schedule.route.source_city.name }} → {{ booking.bus_details.bus_schedule.route.destination_city.name }}</p>
                    <p class="mb-2"><strong>Travel Date:</strong> {{ booking.bus_details.bus_schedule.date|date:"d M Y" }}</p>
                    <p class="mb-2"><strong>Departure:</strong> {{ booking.bus_details.bus_schedule.route.departure_time|time:"H:i" }}</p>
                    <p class="mb-2"><strong>Seats:</strong> {% for seat in booking.bus_details.bus_booking_seats.all %}{{ seat.seat.seat_number }}{% if not forloop.last %}, {% endif %}{% empty %}N/A{% endfor %}</p>
                    <p class="mb-2"><strong>Boarding:</strong> {{ booking.bus_details.boarding_point }}</p>
                    <p class="mb-2"><strong>Dropping:</strong> {{ booking.bus_details.dropping_point }}</p>
                    {% elif booking.package_details %}
                    <hr>
                    <h6>Package Booking Details</h6>
                    <p class="mb-2"><strong>Package:</strong> {{ booking.package_details.package_departure.package.name }}</p>
                    <p class="mb-2"><strong>Departure:</strong> {{ booking.package_details.package_departure.start_date|date:"d M Y" }}</p>
                    <p class="mb-2"><strong>Duration:</strong> {{ booking.package_details.package_departure.package.duration_days }} days</p>
                    <p class="mb-2"><strong>Travelers:</strong> {{ booking.package_details.number_of_travelers }}</p>
                    {% else %}
                    <hr>
                    <div class="alert alert-warning" style="border-left: 3px solid #FFB800;">
                        <i class="fas fa-exclamation-triangle"></i> <strong>Booking Type Not Recognized</strong>
                        <p class="mb-0">Please contact support with your booking ID: <code>{{ booking.booking_id }}</code></p>
                    </div>
                    {% endif %}
                </div>
            </div>
        </div>

        <div class="col-md-4">
            <div class="card">
                <div class="card-body">
                    <div id="expiry-alert" class="alert alert-info small d-none">
                        <i class="fas fa-clock"></i> Reservation active. Complete payment within 10 minutes to avoid expiry.
                    </div>
                    {% if booking.status == 'confirmed' %}
                    <h5 class="card-title">✅ Confirmed</h5>
                    <div class="alert alert-success">
                        <p class="mb-0"><strong>₹{{ total_payable|floatformat:"2" }}</strong></p>
                        <p class="text-muted small mb-0">Payment successful</p>
                    </div>
                    <a href="{% url 'bookings:booking-detail' booking.booking_id %}" class="btn btn-primary w-100">
                        <i class="fas fa-eye"></i> View Details
                    </a>
                    {% else %}
                    <h5 class="card-title">Price Breakdown</h5>
                    
                    <!-- Promo Code Application -->
                    <form method="post" class="mb-3" id="promo-form">
                        {% csrf_token %}
                        <div class="input-group">
                            <input type="text" name="promo" class="form-control" placeholder="Promo Code" value="{{ promo_code.code|default:'' }}" {% if promo_code %}readonly{% endif %}>
                            <input type="hidden" name="promo_code" id="promoAliasCode" value="{{ promo_code.code|default:'' }}">
                            {% if not promo_code %}
                            <button type="submit" class="btn btn-outline-primary">Apply Promo</button>
                            {% else %}
                            <button type="submit" name="remove_promo" class="btn btn-outline-danger">Remove Promo</button>
                            {% endif %}
                        </div>
                        {% if promo_error %}
                        <small class="text-danger" data-testid="promo-error">{{ promo_error }}</small>
                        {% endif %}
                        {% if promo_code %}
                        <small class="text-success">✓ {{ promo_code.code }} applied</small>
                        {% endif %}
                    </form>
                    
                    <div class="alert alert-light border">
                        <h6 style="margin-bottom: 1rem; color: #222;"><i class="fas fa-receipt"></i> Price Details</h6>
                        <table class="table table-sm mb-0">
                            <tr style="border-bottom: 1px solid #e9ecef;">
                                <td style="padding: 0.75rem 0;">
                                    <strong>Room Charges</strong>
                                    <div style="font-size: 0.85rem; color: #666;">
                                        {{ line_rooms|default:booking.hotel_details.number_of_rooms|default:1 }} room(s) × {{ line_nights|default:booking.hotel_details.total_nights|default:1 }} night(s)
                                    </div>
                                </td>
                                <td class="text-end" style="padding: 0.75rem 0;"><strong data-testid="base-amount">₹{{ room_line_amount|floatformat:"0" }}</strong></td>
                            </tr>
                            {% if meal_plan_total and meal_plan_total|floatformat:"0" != "0" %}
                            <tr style="border-bottom: 1px solid #e9ecef;">
                                <td style="padding: 0.75rem 0;">
                                    <strong>Meal Plan</strong>
                                    {% if meal_plan_name %}
                                    <div style="font-size: 0.85rem; color: #666;">{{ meal_plan_name }}</div>
                                    {% endif %}
                                </td>
                                <td class="text-end" style="padding: 0.75rem 0;"><strong>₹{{ meal_plan_total|floatformat:"0" }}</strong></td>
                            </tr>
                            {% endif %}
                            {% if promo_discount > 0 %}
                            <tr class="text-success" style="border-bottom: 1px solid #e9ecef;">
                                <td style="padding: 0.75rem 0;">
                                    <strong>Promo Discount</strong>
                                    {% if promo_code %}
                                    <div style="font-size: 0.85rem;">{{ promo_code.code }}</div>
                                    {% endif %}
                                </td>
                                <td class="text-end" style="padding: 0.75rem 0;"><strong data-testid="discount-amount">-₹{{ promo_discount|floatformat:"0" }}</strong></td>
                            </tr>
                            {% endif %}
                            <tr style="border-bottom: 1px solid #e9ecef;">
                                <td style="padding: 0.75rem 0;">
                                    <strong>Taxes &amp; Fees</strong>
                                    <button type="button" class="btn btn-link btn-sm p-0 ms-1" id="tax-details-trigger" style="font-size: 0.85rem;">ⓘ View breakdown</button>
                                </td>
                                <td class="text-end" style="padding: 0.75rem 0;"><strong data-testid="tax-breakdown">₹{{ taxes_and_fees|floatformat:"0" }}</strong></td>
                            </tr>
                            <tr class="border-top" style="background-color: #f9f9f9;">
                                <td style="padding: 0.75rem 0;"><strong style="font-size: 1.1rem; color: #FF6B35;">Total Payable</strong></td>
                                <td class="text-end" style="padding: 0.75rem 0;"><strong style="font-size: 1.25rem; color: #FF6B35;" data-testid="final-total">₹{{ total_payable|floatformat:"0" }}</strong></td>
                            </tr>
                        </table>
                    </div>

                    <div id="tax-details-modal" class="modal" tabindex="-1" role="dialog" style="display:none;">
                      <div class="modal-dialog" role="document">
                        <div class="modal-content">
                          <div class="modal-header">
                            <h5 class="modal-title">Taxes &amp; Fees Breakdown</h5>
                            <button type="button" class="close" aria-label="Close" onclick="toggleTaxModal(false)">
                              <span aria-hidden="true">&times;</span>
                            </button>
                          </div>
                          <div class="modal-body">
                            <p class="mb-2 d-flex justify-content-between"><span>Service Fee</span><strong data-testid="service-fee">₹{{ platform_fee|floatformat:"0" }}</strong></p>
                            <p class="mb-0 d-flex justify-content-between"><span>GST ({{ gst_rate_percent }}%)</span><strong data-testid="gst-amount">₹{{ gst_amount|floatformat:"0" }}</strong></p>
                          </div>
                          <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" onclick="toggleTaxModal(false)">Close</button>
                          </div>
                        </div>
                      </div>
                    </div>
                    
                    {% if wallet_balance > 0 %}
                    <div class="alert alert-info small">
                        <i class="fas fa-wallet"></i> Wallet Balance: <strong data-testid="wallet-balance">₹{{ wallet_balance|floatformat:"2" }}</strong>
                    </div>
                    {% endif %}

                    <div id="wallet-error" class="alert alert-danger" style="display:none;" data-testid="wallet-error"></div>
                    <div class="d-grid gap-2">
                        <button type="button" class="btn btn-outline-primary" id="use-wallet-btn">Use Wallet</button>
                        <button type="button" class="btn btn-primary" id="confirm-booking-btn" data-testid="confirm-booking">Confirm Booking</button>
                    </div>
                    
                    <form method="post" class="text-center">
                        {% csrf_token %}
                        <input type="hidden" name="proceed_to_payment" value="1">
                        <button type="submit" class="btn btn-primary btn-lg w-100" id="proceed-payment-btn" {% if booking.status == 'expired' %}disabled{% endif %}>
                            <i class="fas fa-credit-card"></i> Proceed to Payment
                        </button>
                    </form>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
    {% endif %}  {# Close the main 'if not booking' / 'else' block #}
</div>
{% endblock %}

{% block extra_js %}
<script>
// ===== ISSUE #9 FIX: Back button handler - returns to correct booking type AND preserves session state =====
function goBackToBooking() {
    const bookingType = '{{ booking.booking_type }}';
    const bookingReturnUrl = '{{ booking_return_url|default:"" }}';

    if (bookingReturnUrl) {
        window.location.href = bookingReturnUrl;
        return;
    }

    if (bookingType === 'bus') {
    // Mirror 'promo' to 'promo_code' to satisfy backend while tests use 'promo'
    document.addEventListener('DOMContentLoaded', function(){
        var form = document.getElementById('promo-form');
        var promoInput = form ? form.querySelector('input[name="promo"]') : null;
        var alias = document.getElementById('promoAliasCode');
        if (form && promoInput && alias) {
            promoInput.addEventListener('input', function(){ alias.value = promoInput.value || ''; });
            form.addEventListener('submit', function(){ alias.value = promoInput.value || ''; });
        }
    });
        window.location.href = '/buses/';
        return;
    }
    if (bookingType === 'package') {
        window.location.href = '/packages/';
        return;
    }

    history.back();
}

function toggleTaxModal(show) {
    var modal = document.getElementById('tax-details-modal');
    if (!modal) return;
    modal.style.display = show ? 'block' : 'none';
}

var taxTrigger = document.getElementById('tax-details-trigger');
if (taxTrigger) {
    taxTrigger.addEventListener('click', function() { toggleTaxModal(true); });
}

(function() {
    const countdownEl = document.getElementById('expiry-countdown');
    if (!countdownEl) return;

    let remaining = parseInt(countdownEl.dataset.seconds || '0', 10);
    const proceedBtn = document.getElementById('proceed-payment-btn');
    const statusBadge = document.getElementById('booking-status');
    const alertBox = document.getElementById('expiry-alert');

    function renderCountdown() {
        if (remaining <= 0) {
            countdownEl.textContent = 'Expired';
            if (statusBadge) {
                statusBadge.className = 'badge bg-danger';
                statusBadge.textContent = 'Expired';
            }
            if (proceedBtn) {
                proceedBtn.disabled = true;
                proceedBtn.textContent = 'Reservation expired';
            }
            if (alertBox) {
                alertBox.classList.remove('alert-info');
                alertBox.classList.add('alert-danger');
                alertBox.classList.remove('d-none');
                alertBox.innerHTML = '<p class="mb-0"><strong>Reservation expired. Please start a new booking.</strong></p>';
            }
            clearInterval(timerId);
            return;
        }
        const minutes = Math.floor(remaining / 60);
        const seconds = remaining % 60;
        countdownEl.textContent = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
        if (remaining <= 120) {
            countdownEl.classList.add('text-warning');
            if (alertBox) {
                alertBox.classList.remove('d-none');
                alertBox.classList.remove('alert-info');
                alertBox.classList.add('alert-warning');
                alertBox.innerHTML = '<p class="mb-0"><strong>Almost out of time.</strong> Complete payment to keep your reservation.</p>';
            }
        }
        remaining -= 1;
    }

    const timerId = setInterval(renderCountdown, 1000);
    renderCountdown();
})();

// Wallet interaction: show error if insufficient, enable confirm if sufficient
document.addEventListener('DOMContentLoaded', function(){
    var useBtn = document.getElementById('use-wallet-btn');
    var err = document.getElementById('wallet-error');
    var confirmBtn = document.getElementById('confirm-booking-btn');
    var balanceEl = document.querySelector('[data-testid="wallet-balance"]');
    var totalEl = document.querySelector('[data-testid="final-total"]');
    if (!useBtn || !err || !confirmBtn || !balanceEl || !totalEl) return;
    function parseAmount(el){
        var t = (el.textContent || '').replace(/[^0-9.]/g,'');
        return parseFloat(t || '0') || 0;
    }
    useBtn.addEventListener('click', function(){
        var bal = parseAmount(balanceEl);
        var total = parseAmount(totalEl);
        if (bal < total) {
            err.style.display = 'block';
            err.textContent = 'Insufficient wallet balance';
            confirmBtn.disabled = true;
        } else {
            err.style.display = 'none';
            confirmBtn.disabled = false;
        }
    });
    confirmBtn.addEventListener('click', function(){
        // Redirect to wallet-only confirmation if enabled
        if (confirmBtn.disabled) return;
        window.location.href = '{% url "bookings:confirm-wallet-only" booking.booking_id %}';
    });
});
</script>
{% endblock %}
